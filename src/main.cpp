#include <Arduino.h>
#include <jbd013_api.h>
#include <SPI.h>
#include <driver/spi_master.h>
#include <HardwareSerial.h>
#include <string.h>
#include <WiFi.h>
#include <WebServer.h>
#include <FS.h>
#include <SPIFFS.h>
#include "../group1_image_improved.h"
// ÂºïËÑöÂÆö‰πâ
//#define TFT_CLK 14
#define TFT_CS0 33
#define TFT_CS1 3
#define TFT_D0 37
#define TFT_D1 40
#define TFT_D2 23
#define TFT_D3 5
// SPIÂºïËÑö
#define SPI_CLK 36  // SPIÊó∂ÈíüÂºïËÑö 3
#define SPI_MISO 37 // SPI MISOÂºïËÑö  46
#define SPI_MOSI 35 // SPI MOSIÂºïËÑö  42
#define SPI_CS 33  // SPIÁâáÈÄâÂºïËÑö spi_wr_byteÊúâBugÊâÄ‰ª•ËøôÊù°Êó†Êïà  ËøôÊù°Ë¶ÅÂú®hal_DriverÊîπ
// ‰∏≤Âè£Êò†Â∞Ñ
//HardwareSerial MySerial_esp32(1);
// ËÆæÁΩÆÈù¢ÊùøÁîªÈù¢

uint8_t screenRow = 0x28;

u8 image[22480] = {};

u8 image1[10240] = {};
u8 image2[10240] = {};
u8 image3[10240] = {};
u8 image4[10240] = {};
u8 image5[10240] = {};
u8 image6[10240] = {};
u8 image7[10240] = {};
u8 image8[10240] = {};
u8 image9[10240] = {};
u8 image10[10240] = {};
u8 image11[10240] = {};
u8 image12[10240] = {};
u8 image13[10240] = {};
u8 image14[10240] = {};
u8 image15[10240] = {};
u8 image16[10240] = {};
u8 image17[10240] = {};
u8 image18[10240] = {};
u8 image19[10240] = {};
u8 image20[10240] = {};
u8 image21[10240] = {};
u8 image22[10240] = {};
u8 image23[10240] = {};
u8 image24[10240] = {};
u8 image25[10240] = {};
u8 image26[10240] = {};
u8 image27[10240] = {};
u8 image28[10240] = {};
u8 image29[10240] = {};
u8 image30[10240] = {};

u8 fontA[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
u8 fontB[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00, 0x00,0xFF,0xFF,0x00,0x00,0xFF,0x00,0x00, 0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00, 0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00, 0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00, 0x00,0xFF,0xFF,0x00,0x00,0xFF,0x00,0x00, 0x00,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
};
u8 fontC[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00, 0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00, 0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00, 0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
u8 fontD[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00, 0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00, 0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00, 0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00, 0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00, 0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00, 0x00,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00, 0x00,0x00,0xFF,0xFF,0xFF,0x00,0xFF,0xFF, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};
u8 fontE[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};
u8 fontF[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};
u8 fontG[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,};
u8 fontH[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};
u8 fontI[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
};
u8 fontJ[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,};
u8 fontK[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0x00, 0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00, 0x00,0xFF,0x00,0xFF,0x00,0x00,0x00,0x00, 0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00, 0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00, 0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00, 0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};
u8 fontL[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00, 0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00, 0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};
u8 fontM[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00, 0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0xFF, 0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0xFF, 0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0xFF, 0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0xFF, 0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0xFF, 0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0xFF, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};
u8 fontN[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};
u8 fontO[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};
u8 fontP[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,
};
u8 fontQ[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,};
u8 fontR[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};
u8 fontS[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};
u8 fontT[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};
u8 fontU[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};
u8 fontV[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};
u8 fontW[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0xFF,0x00,0x00,0xFF,0x00,0xFF,0x00,0x00,0xFF,0x00,0xFF,0xFF,0x00,0xFF,0x00,0x00,0xFF,0x00,0xFF,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
};
u8 fontX[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};
u8 fontY[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,};
u8 fontZ[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};
u8 fontDot[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,};
u8 fontSpace[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};
u8 fontEndot[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};

u8 font1[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};

u8 font2[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};

u8 font3[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};

u8 font4[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};

u8 font5[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};

u8 font6[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};

u8 font7[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};

u8 font8[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};

u8 font9[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};

u8 font0[128] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,};


int drawed = 0;

uint32_t image_len = 20480;

// ÊñáÊú¨Ê∞¥Âπ≥ÁøªËΩ¨ÊéßÂà∂ÂèòÈáè
bool textFlipEnabled = true;

// ‰∫ÆÂ∫¶ÊéßÂà∂ÂèòÈáè (ÈªòËÆ§‰∏∫ËæÉ‰Ωé‰∫ÆÂ∫¶)
u16 currentBrightness = 800;

// WiFiÂíåWebÊúçÂä°Âô®ÈÖçÁΩÆ
const char* wifi_ssid = "Hyperoptic Fibre 93B3";
const char* wifi_password = "pebdriAnU3347Y";
WebServer server(80);  // HTTPÁ´ØÂè£80

// ‰∏ä‰º†ÂõæÂÉèÁºìÂÜ≤Âå∫
u8* uploadedImageData = nullptr;
u16 uploadedImageWidth = 0;
u16 uploadedImageHeight = 0;
bool hasUploadedImage = false;

// ‰∏ä‰º†ÁöÑÂéüÂßãPNGÊï∞ÊçÆ
u8* uploadedPngData = nullptr;
size_t uploadedPngSize = 0;

// ÂõæÂÉèÈ¢úËâ≤ÂèçËΩ¨ÂºÄÂÖ≥Ôºàtrue = ÂèçËΩ¨Ôºâ
bool invertEnabled = true;

// FSÊñπÂºèÁöÑBIN‰∏ä‰º†ÂÖÉÊï∞ÊçÆ
bool hasUploadedBinFS = false;
u16 fsBinW = 0;
u16 fsBinH = 0;
const char* fsBinPath = "/uploaded.bin";

// ÂáΩÊï∞Â£∞Êòé
void JBD_init(void);
void drawLetter(char letter);
void drawString(const char text[], int len);
void setTextHorizontalFlip(bool enable);
void setBrightness(u16 brightness);
void setBrightnessLow();
void setBrightnessMedium();
void setBrightnessHigh();
void connectToWiFi();
void setupWebServer();
void handleRoot();
void handleBrightness();
void handleFlip();
void handleStatus();
void handleGetBrightness();
void handleGetWiFiStatus();
void handleInvert();
void handleDisplayPower();
void handleUpload();
void handleUploadPage();
void handleUploadBin();
void handleUploadBinPage();
void handleDisplayImage();
void handleUploadChunk();
bool processUploadedPNG(uint8_t* data, size_t length);
void displayUploadedImage();
void createTestUploadedImage();
void processPngToImage();
void renderGreenCircle(u8 *dest, u16 widthPixels, u16 heightRows, u8 grayLevel);
void packPngRowsToPanel(u8 *dest, u16 destWidth, const u8 *src, u16 srcWidth, u16 rowStart, u16 rows);
void packPngScaledRowsToPanel(u8 *dest,
                              u16 destWidth,
                              u16 destHeight,
                              const u8 *src,
                              u16 srcWidth,
                              u16 srcHeight,
                              u16 rowStart,
                              u16 rows,
                              bool invert);

// ÈÖçÁΩÆÂºïËÑö
void JBD_init(void)
{
  //pinMode(TFT_CLK, OUTPUT);
  pinMode(TFT_CS0, OUTPUT);
  pinMode(TFT_CS1, OUTPUT);
  pinMode(TFT_D0, OUTPUT);  // miso
  pinMode(TFT_D1, OUTPUT); // mosi
  pinMode(TFT_D2, OUTPUT);
  pinMode(TFT_D3, OUTPUT);

  digitalWrite(TFT_CS0,HIGH);
  digitalWrite(TFT_CS1,HIGH);
}

void drawLetter(char letter){
  int lenPerLetter = 8;
  int c_cursor = 0;
  int ret;
  int counter = 0;

  if(letter == 'a'){
    for(int i = 0; i < sizeof(fontA); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontA[i];
      counter++;
    }
    drawed++;
  }
  if(letter == 'b'){
    for(int i = 0; i < sizeof(fontB); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontB[i];
      counter++;
    }
    drawed++;
  }
  if(letter == 'c'){
    for(int i = 0; i < sizeof(fontC); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontC[i];
      counter++;
    }
    drawed++;
  }
  if(letter == 'd'){
    for(int i = 0; i < sizeof(fontD); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontD[i];
      counter++;
    }
    drawed++;
  }
  if(letter == 'e'){
    for(int i = 0; i < sizeof(fontE); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontE[i];
      counter++;
    }
    drawed++;
  }
  if(letter == 'f'){
    for(int i = 0; i < sizeof(fontF); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontF[i];
      counter++;
    }
    drawed++;
  }
  if(letter == 'g'){
    for(int i = 0; i < sizeof(fontG); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontG[i];
      counter++;
    }
    drawed++;
  }
  if(letter == 'h'){
    for(int i = 0; i < sizeof(fontH); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontH[i];
      counter++;
    }
    drawed++;
  }
  if(letter == 'i'){
    for(int i = 0; i < sizeof(fontI); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontI[i];
      counter++;
    }
    drawed++;
  }
  if(letter == 'j'){
    for(int i = 0; i < sizeof(fontJ); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontJ[i];
      counter++;
    }
    drawed++;
  }
  if(letter == 'k'){
    for(int i = 0; i < sizeof(fontK); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontK[i];
      counter++;
    }
    drawed++;
  }
  if(letter == 'l'){
    for(int i = 0; i < sizeof(fontL); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontL[i];
      counter++;
    }
    drawed++;
  }
  if(letter == 'm'){
    for(int i = 0; i < sizeof(fontM); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontM[i];
      counter++;
    }
    drawed++;
  }
  if(letter == 'n'){
    for(int i = 0; i < sizeof(fontN); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontN[i];
      counter++;
    }
    drawed++;
  }
  if(letter == 'o'){
    for(int i = 0; i < sizeof(fontO); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontO[i];
      counter++;
    }
    drawed++;
  }
  if(letter == 'p'){
    for(int i = 0; i < sizeof(fontP); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontP[i];
      counter++;
    }
    drawed++;
  }
  if(letter == 'q'){
    for(int i = 0; i < sizeof(fontQ); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontQ[i];
      counter++;
    }
    drawed++;
  }
  if(letter == 'r'){
    for(int i = 0; i < sizeof(fontR); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontR[i];
      counter++;
    }
    drawed++;
  }
  if(letter == 's'){
    for(int i = 0; i < sizeof(fontS); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontS[i];
      counter++;
    }
    drawed++;
  }
  if(letter == 't'){
    for(int i = 0; i < sizeof(fontT); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontT[i];
      counter++;
    }
    drawed++;
  }
  if(letter == 'u'){
    for(int i = 0; i < sizeof(fontU); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontU[i];
      counter++;
    }
    drawed++;
  }
  if(letter == 'v'){
    for(int i = 0; i < sizeof(fontV); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontV[i];
      counter++;
    }
    drawed++;
  }
  if(letter == 'w'){
    for(int i = 0; i < sizeof(fontW); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontW[i];
      counter++;
    }
    drawed++;
  }
  if(letter == 'x'){
    for(int i = 0; i < sizeof(fontX); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontX[i];
      counter++;
    }
    drawed++;
  }
  if(letter == 'y'){
    for(int i = 0; i < sizeof(fontY); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontY[i];
      counter++;
    }
    drawed++;
  }
  if(letter == 'z'){
    for(int i = 0; i < sizeof(fontZ); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontZ[i];
      counter++;
    }
    drawed++;
  }
  if(letter == ','){
    for(int i = 0; i < sizeof(fontDot); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontDot[i];
      counter++;
    }
    drawed++;
  }
  if(letter == '.'){
    for(int i = 0; i < sizeof(fontEndot); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontEndot[i];
      counter++;
    }
    drawed++;
  }
  if(letter == ' '){
    for(int i = 0; i < sizeof(fontSpace); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = fontSpace[i];
      counter++;
    }
    drawed++;
  }
  if(letter == '0'){
    for(int i = 0; i < sizeof(font0); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = font0[i];
      counter++;
    }
    drawed++;
  }
  if(letter == '1'){
    for(int i = 0; i < sizeof(font1); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = font1[i];
      counter++;
    }
    drawed++;
  }
  if(letter == '2'){
    for(int i = 0; i < sizeof(font2); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = font2[i];
      counter++;
    }
    drawed++;
  }
  if(letter == '3'){
    for(int i = 0; i < sizeof(font3); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = font3[i];
      counter++;
    }
    drawed++;
  }
  if(letter == '4'){
    for(int i = 0; i < sizeof(font4); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = font4[i];
      counter++;
    }
    drawed++;
  }
  if(letter == '5'){
    for(int i = 0; i < sizeof(font5); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = font5[i];
      counter++;
    }
    drawed++;
  }
  if(letter == '6'){
    for(int i = 0; i < sizeof(font6); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = font6[i];
      counter++;
    }
    drawed++;
  }
  if(letter == '7'){
    for(int i = 0; i < sizeof(font7); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = font7[i];
      counter++;
    }
    drawed++;
  }
  if(letter == '8'){
    for(int i = 0; i < sizeof(font8); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = font8[i];
      counter++;
    }
    drawed++;
  }
  if(letter == '9'){
    for(int i = 0; i < sizeof(font9); i++){
      if( counter == 8){
        counter = 0;
        c_cursor++;
      }
      image[drawed*lenPerLetter+c_cursor*640+counter] = font9[i];
      counter++;
    }
    drawed++;
  }
}

void drawString(const char text[],int len){
  for (int i=0; i<len; i++) {
      char character = text[i];
      Serial.write(character);
      Serial.write('\r');
      Serial.write('\n');
      drawLetter(character);
  }
}

// ËÆæÁΩÆÊñáÊú¨Ê∞¥Âπ≥ÁøªËΩ¨
void setTextHorizontalFlip(bool enable) {
  textFlipEnabled = enable;
  if (enable) {
    set_mirror_mode(1); // Mirror left and right only
  } else {
    set_mirror_mode(0); // Normal display
  }
}

// ËÆæÁΩÆ‰∫ÆÂ∫¶ (ÈÄöÁî®ÂáΩÊï∞)
// ‰∫ÆÂ∫¶ËåÉÂõ¥ÂèñÂÜ≥‰∫éÂà∑Êñ∞È¢ëÁéá:
// 25Hz: 0-21331, 50Hz: 0-10664, 75Hz: 0-7109, 100Hz: 0-5331
// 125Hz: 0-4264, 150Hz: 0-3366, 175Hz: 0-2907, 200Hz: 0-2558
void setBrightness(u16 brightness) {
  Serial.print("ËÆæÁΩÆ‰∫ÆÂ∫¶: ");
  Serial.print(brightness);
  Serial.print(" (ÂΩìÂâç: ");
  Serial.print(currentBrightness);
  Serial.println(")");
  
  // ÂêØÁî®Áä∂ÊÄÅÂØÑÂ≠òÂô®ÂÜôÂÖ•
  send_cmd(SPI_WR_ENABLE);
  delay_ms(1);
  
  currentBrightness = brightness;
  wr_lum_reg(brightness);
  delay_ms(10); // ÁªôÁ°¨‰ª∂Êó∂Èó¥Â§ÑÁêÜÂëΩ‰ª§
  
  // ÈáçÊñ∞ÂêØÁî®ÊòæÁ§∫Âπ∂ÂêåÊ≠•ÔºàÂº∫Âà∂Âà∑Êñ∞‰∫ÆÂ∫¶Ôºâ
  send_cmd(SPI_DISPLAY_ENABLE);
  delay_ms(1);
  send_cmd(SPI_SYNC);
  delay_ms(1);
  
  // ËØªÂèñÂõûÂØÑÂ≠òÂô®Á°ÆËÆ§
  u16 readBack = rd_lum_reg();
  Serial.print("ËØªÂèñÂõûÁöÑ‰∫ÆÂ∫¶ÂÄº: ");
  Serial.println(readBack);
  Serial.println("‰∫ÆÂ∫¶Â∑≤ËÆæÁΩÆÂπ∂Âº∫Âà∂Âà∑Êñ∞ÊòæÁ§∫");
}

// ËÆæÁΩÆ‰Ωé‰∫ÆÂ∫¶ (25% - ÈÄÇÂêàÂÆ§ÂÜÖ‰ΩøÁî®)
void setBrightnessLow() {
  setBrightness(800);   // Êõ¥‰øùÂÆàÁöÑ‰Ωé‰∫ÆÂ∫¶ÂÄº
}

// ËÆæÁΩÆ‰∏≠Á≠â‰∫ÆÂ∫¶ (50% - Âπ≥Ë°°‰ΩøÁî®)
void setBrightnessMedium() {
  setBrightness(1600);  // Êõ¥‰øùÂÆàÁöÑ‰∏≠Á≠â‰∫ÆÂ∫¶ÂÄº
}

// ËÆæÁΩÆÈ´ò‰∫ÆÂ∫¶ (80% - Êà∑Â§ñ‰ΩøÁî®)
void setBrightnessHigh() {
  setBrightness(2500);  // Á®çÈ´ò‰∏Ä‰∫õÁöÑÂÄºÊù•ÊµãËØï
}

// WiFiËøûÊé•ÂáΩÊï∞
void connectToWiFi() {
  Serial.println("Ê≠£Âú®ËøûÊé•WiFi...");
  WiFi.begin(wifi_ssid, wifi_password);
  
  int attempts = 0;
  while (WiFi.status() != WL_CONNECTED && attempts < 30) {
    delay(1000);
    Serial.print(".");
    attempts++;
  }
  
  if (WiFi.status() == WL_CONNECTED) {
    Serial.println();
    Serial.println("WiFiËøûÊé•ÊàêÂäü!");
    Serial.print("IPÂú∞ÂùÄ: ");
    Serial.println(WiFi.localIP());
    Serial.print("Á´ØÂè£: 80");
    Serial.println();
  } else {
    Serial.println("WiFiËøûÊé•Â§±Ë¥•!");
  }
}

// WebÊúçÂä°Âô®Ë∑ØÁî±Â§ÑÁêÜ
void handleRoot() {
  String html = "<!DOCTYPE html><html><head><meta charset='UTF-8'>";
  html += "<title>ARÁúºÈïúÊéßÂà∂Èù¢Êùø</title>";
  html += "<style>body{font-family:Arial;margin:40px;background:#f0f0f0;}";
  html += ".container{max-width:600px;margin:0 auto;background:white;padding:30px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1);}";
  html += "h1{color:#333;text-align:center;}";
  html += ".control{margin:20px 0;padding:15px;border:1px solid #ddd;border-radius:5px;}";
  html += "button{padding:10px 20px;margin:5px;border:none;border-radius:5px;cursor:pointer;font-size:16px;}";
  html += ".btn-primary{background:#007bff;color:white;}";
  html += ".btn-success{background:#28a745;color:white;}";
  html += ".btn-warning{background:#ffc107;color:black;}";
  html += ".btn-danger{background:#dc3545;color:white;}";
  html += "</style></head><body>";
  html += "<div class='container'>";
  html += "<h1>ü•Ω ARÁúºÈïúÊéßÂà∂Èù¢Êùø</h1>";
  
  // WiFiÁä∂ÊÄÅÊòæÁ§∫
  html += "<div class='control' style='background:#e8f5e8;border-left:4px solid #28a745;'>";
  html += "<h3>üì° WiFiÁä∂ÊÄÅ</h3>";
  html += "<div style='display:flex;justify-content:space-between;align-items:center;'>";
  html += "<div>";
  html += "<strong>ÁΩëÁªú:</strong> " + String(wifi_ssid) + "<br>";
  html += "<strong>IPÂú∞ÂùÄ:</strong> <span id='ipAddress'>" + WiFi.localIP().toString() + "</span><br>";
  html += "<strong>‰ø°Âè∑Âº∫Â∫¶:</strong> <span id='signalStrength'>" + String(WiFi.RSSI()) + " dBm</span>";
  html += "</div>";
  html += "<div style='font-size:24px;color:#28a745;'>üì∂</div>";
  html += "</div>";
  html += "</div>";
  
  html += "<div class='control'><h3>üí° ‰∫ÆÂ∫¶ÊéßÂà∂</h3>";
  html += "<div style='margin-bottom:10px;'>ÂΩìÂâç‰∫ÆÂ∫¶: <span id='currentBrightness' style='font-weight:bold;color:#007bff;'>--</span></div>";
  html += "<div style='display:flex;align-items:center;gap:8px;margin-bottom:10px;'>";
  html += "<input id='brightnessInput' type='number' min='0' max='2500' step='50' placeholder='0-2500' style='width:120px;padding:6px;'>";
  html += "<button class='btn-primary' onclick=\"setBrightnessValue()\">ËÆæÁΩÆ‰∫ÆÂ∫¶</button>";
  html += "</div>";
  html += "<button class='btn-primary' onclick=\"setBrightness('low')\">‰Ωé‰∫ÆÂ∫¶ (800)</button>";
  html += "<button class='btn-success' onclick=\"setBrightness('medium')\">‰∏≠‰∫ÆÂ∫¶ (1600)</button>";
  html += "<button class='btn-warning' onclick=\"setBrightness('high')\">È´ò‰∫ÆÂ∫¶ (2500)</button>";
  html += "</div>";

  // È¢úËâ≤ÂèçËΩ¨
  html += "<div class='control'><h3>üé® È¢úËâ≤ÂèçËΩ¨</h3>";
  html += "<button class='btn-primary' onclick=\"fetch('/invert?enable=true')\">ÂêØÁî®ÂèçËΩ¨</button>";
  html += "<button class='btn-danger' onclick=\"fetch('/invert?enable=false')\">Á¶ÅÁî®ÂèçËΩ¨</button>";
  html += "<div style='margin-top:8px'>ÂΩìÂâç: <b>";
  html += String(invertEnabled ? "ÂêØÁî®" : "Á¶ÅÁî®");
  html += "</b></div>";
  html += "</div>";
  
  html += "<script>";
  html += "function setBrightness(level) {";
  html += "  fetch('/brightness?level=' + level).then(() => updateBrightness());";
  html += "}";
  html += "function setBrightnessValue() {";
  html += "  const el=document.getElementById('brightnessInput');";
  html += "  let v=parseInt(el.value||'0'); if(isNaN(v)) v=0; if(v<0) v=0; if(v>2500) v=2500;";
  html += "  fetch('/brightness?value=' + v).then(() => updateBrightness());";
  html += "}";
  html += "function updateBrightness() {";
  html += "  fetch('/api/brightness').then(r => r.json()).then(data => {";
  html += "    document.getElementById('currentBrightness').textContent = data.current + ' (reg: ' + data.register + ')';";
  html += "  });";
  html += "}";
  html += "updateBrightness(); setInterval(updateBrightness, 2000);";
  html += "function displayImage() {";
  html += "  fetch('/display-image').then(r => r.text()).then(msg => alert(msg));";
  html += "}";
  html += "function updateWiFiStatus() {";
  html += "  fetch('/api/wifi-status').then(r => r.json()).then(data => {";
  html += "    document.getElementById('signalStrength').textContent = data.rssi + ' dBm';";
  html += "  }).catch(e => console.log('WiFi status update failed'));";
  html += "}";
  html += "setInterval(updateWiFiStatus, 5000);"; // ÊØè5ÁßíÊõ¥Êñ∞WiFiÁä∂ÊÄÅ
  html += "</script>";
  
  html += "<div class='control'><h3>üîÑ ÊòæÁ§∫ÁøªËΩ¨</h3>";
  html += "<button class='btn-primary' onclick=\"fetch('/flip?enable=true')\">ÂêØÁî®Ê∞¥Âπ≥ÁøªËΩ¨</button>";
  html += "<button class='btn-danger' onclick=\"fetch('/flip?enable=false')\">Á¶ÅÁî®Ê∞¥Âπ≥ÁøªËΩ¨</button>";
  html += "</div>";
  
  html += "<div class='control'><h3>üñºÔ∏è ÂõæÂÉè‰∏ä‰º†</h3>";
  html += "<button class='btn-primary' onclick=\"window.location.href='/upload'\">‰∏ä‰º†PNGÂõæÂÉè</button>";
  if (hasUploadedImage) {
    html += "<button class='btn-success' onclick=\"displayImage()\" style='margin-left:10px;'>ÊòæÁ§∫‰∏ä‰º†ÁöÑÂõæÂÉè</button>";
  }
  html += "<button class='btn-warning' onclick=\"window.location.href='/upload-bin'\" style='margin-left:10px;'>‰∏ä‰º†BIN(ÂéüÂßãÁÅ∞Â∫¶)</button>";
  html += "</div>";

  // ÊòæÁ§∫ÁîµÊ∫ê
  html += "<div class='control'><h3>üñ•Ô∏è Â±èÂπïÁîµÊ∫ê</h3>";
  html += "<button class='btn-primary' onclick=\"fetch('/display-power?on=1')\">ÂºÄÂêØÊòæÁ§∫</button>";
  html += "<button class='btn-danger' onclick=\"fetch('/display-power?on=0')\">ÂÖ≥Èó≠ÊòæÁ§∫</button>";
  html += "</div>";
  
  html += "<div class='control'><h3>üìä Áä∂ÊÄÅ‰ø°ÊÅØ</h3>";
  html += "<button class='btn-primary' onclick=\"window.location.href='/status'\">Êü•ÁúãÁä∂ÊÄÅ</button>";
  html += "</div>";
  
  html += "</div></body></html>";
  
  server.send(200, "text/html", html);
}

void handleBrightness() {
  String level = server.arg("level");
  String value = server.arg("value");
  
  Serial.print("Êî∂Âà∞‰∫ÆÂ∫¶Ë∞ÉÊï¥ËØ∑Ê±Ç: ");
  Serial.println(level.length()? level : value);
  
  if (value.length()) {
    int v = value.toInt();
    if (v < 0) v = 0; if (v > 2500) v = 2500;
    setBrightness((u16)v);
    server.send(200, "text/plain", String("‰∫ÆÂ∫¶ËÆæÁΩÆ‰∏∫ ") + v);
    return;
  } else if (level == "low") {
    setBrightnessLow();
    Serial.println("ÊâßË°å‰∫ÆÂ∫¶Ë∞ÉÊï¥: ‰Ωé (800)");
    server.send(200, "text/plain", "‰∫ÆÂ∫¶ËÆæÁΩÆ‰∏∫‰Ωé (800)");
  } else if (level == "medium") {
    setBrightnessMedium();
    Serial.println("ÊâßË°å‰∫ÆÂ∫¶Ë∞ÉÊï¥: ‰∏≠ (1600)");
    server.send(200, "text/plain", "‰∫ÆÂ∫¶ËÆæÁΩÆ‰∏∫‰∏≠ (1600)");
  } else if (level == "high") {
    setBrightnessHigh();
    Serial.println("ÊâßË°å‰∫ÆÂ∫¶Ë∞ÉÊï¥: È´ò (2500)");
    server.send(200, "text/plain", "‰∫ÆÂ∫¶ËÆæÁΩÆ‰∏∫È´ò (2500)");
  } else {
    Serial.println("Êó†ÊïàÁöÑ‰∫ÆÂ∫¶ÂèÇÊï∞: " + level);
    server.send(400, "text/plain", "Êó†ÊïàÁöÑ‰∫ÆÂ∫¶ÂèÇÊï∞");
  }
}

void handleFlip() {
  String enable = server.arg("enable");
  
  if (enable == "true") {
    setTextHorizontalFlip(true);
    server.send(200, "text/plain", "Ê∞¥Âπ≥ÁøªËΩ¨Â∑≤ÂêØÁî®");
  } else if (enable == "false") {
    setTextHorizontalFlip(false);
    server.send(200, "text/plain", "Ê∞¥Âπ≥ÁøªËΩ¨Â∑≤Á¶ÅÁî®");
  } else {
    server.send(400, "text/plain", "Êó†ÊïàÁöÑÁøªËΩ¨ÂèÇÊï∞");
  }
}

// È¢úËâ≤ÂèçËΩ¨ÊéßÂà∂
void handleInvert() {
  String enable = server.arg("enable");
  if (enable == "true") {
    invertEnabled = true;
    server.send(200, "text/plain", "invert on");
  } else if (enable == "false") {
    invertEnabled = false;
    server.send(200, "text/plain", "invert off");
  } else {
    server.send(400, "text/plain", "invalid param");
  }
}

// ÂºÄÂÖ≥ÊòæÁ§∫ÁîµÊ∫ê
void handleDisplayPower() {
  String on = server.arg("on");
  if (on == "1") {
    send_cmd(SPI_DISPLAY_ENABLE);
    send_cmd(SPI_SYNC);
    server.send(200, "text/plain", "display on");
  } else if (on == "0") {
    send_cmd(SPI_DISPLAY_DISABLE);
    send_cmd(SPI_SYNC);
    server.send(200, "text/plain", "display off");
  } else {
    server.send(400, "text/plain", "invalid param");
  }
}

void handleStatus() {
  String html = "<!DOCTYPE html><html><head><meta charset='UTF-8'>";
  html += "<title>AR Device Status</title>";
  html += "<style>body{font-family:Arial;margin:40px;background:#f0f0f0;}";
  html += ".container{max-width:600px;margin:0 auto;background:white;padding:30px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1);}";
  html += "h1{color:#333;text-align:center;}";
  html += ".status-item{margin:15px 0;padding:10px;background:#f8f9fa;border-left:4px solid #007bff;border-radius:4px;}";
  html += ".label{font-weight:bold;color:#495057;}";
  html += ".value{color:#28a745;margin-left:10px;}";
  html += ".refresh-btn{background:#007bff;color:white;padding:10px 20px;border:none;border-radius:5px;cursor:pointer;margin-top:20px;}";
  html += "</style></head><body>";
  html += "<div class='container'>";
  html += "<h1>üìä AR Device Status</h1>";
  
  html += "<div class='status-item'>";
  html += "<span class='label'>üåê WiFi Network:</span>";
  html += "<span class='value'>" + String(wifi_ssid) + "</span>";
  html += "</div>";
  
  html += "<div class='status-item'>";
  html += "<span class='label'>üîó IP Address:</span>";
  html += "<span class='value'>" + WiFi.localIP().toString() + "</span>";
  html += "</div>";
  
  html += "<div class='status-item'>";
  html += "<span class='label'>üì∂ Signal Strength:</span>";
  html += "<span class='value'>" + String(WiFi.RSSI()) + " dBm</span>";
  html += "</div>";
  
  html += "<div class='status-item'>";
  html += "<span class='label'>üí° Current Brightness:</span>";
  html += "<span class='value'>" + String(currentBrightness) + "</span>";
  html += "</div>";
  
  html += "<div class='status-item'>";
  html += "<span class='label'>üîÑ Horizontal Flip:</span>";
  html += "<span class='value'>" + String(textFlipEnabled ? "Enabled" : "Disabled") + "</span>";
  html += "</div>";
  
  html += "<div class='status-item'>";
  html += "<span class='label'>‚è±Ô∏è Uptime:</span>";
  html += "<span class='value'>" + String(millis() / 1000) + " seconds</span>";
  html += "</div>";
  
  html += "<div class='status-item'>";
  html += "<span class='label'>üíæ Free RAM:</span>";
  html += "<span class='value'>" + String(ESP.getFreeHeap()) + " bytes</span>";
  html += "</div>";
  
  html += "<div class='status-item'>";
  html += "<span class='label'>üíΩ Flash Size:</span>";
  html += "<span class='value'>" + String(ESP.getFlashChipSize()) + " bytes</span>";
  html += "</div>";
  
  html += "<button class='refresh-btn' onclick='window.location.reload()'>üîÑ Refresh</button>";
  html += "<button class='refresh-btn' onclick='window.location.href=\"/\"' style='margin-left:10px;background:#28a745;'>üè† Home</button>";
  html += "</div></body></html>";
  
  server.send(200, "text/html", html);
}

void handleGetBrightness() {
  String json = "{";
  json += "\"current\": " + String(currentBrightness) + ",";
  json += "\"register\": " + String(rd_lum_reg()) + ",";
  json += "\"timestamp\": " + String(millis());
  json += "}";
  
  server.send(200, "application/json", json);
}

void handleGetWiFiStatus() {
  String json = "{";
  json += "\"ssid\": \"" + String(wifi_ssid) + "\",";
  json += "\"ip\": \"" + WiFi.localIP().toString() + "\",";
  json += "\"rssi\": " + String(WiFi.RSSI()) + ",";
  json += "\"connected\": " + String(WiFi.status() == WL_CONNECTED ? "true" : "false") + ",";
  json += "\"timestamp\": " + String(millis());
  json += "}";
  
  server.send(200, "application/json", json);
}

void handleUploadPage() {
  String html = "<!DOCTYPE html><html><head><meta charset='UTF-8'>";
  html += "<title>Upload PNG Image</title>";
  html += "<style>body{font-family:Arial;margin:40px;background:#f0f0f0;}";
  html += ".container{max-width:600px;margin:0 auto;background:white;padding:30px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1);}";
  html += "h1{color:#333;text-align:center;}";
  html += ".upload-area{border:2px dashed #007bff;border-radius:10px;padding:40px;text-align:center;margin:20px 0;}";
  html += "input[type=file]{margin:20px 0;}";
  html += ".btn{background:#007bff;color:white;padding:10px 20px;border:none;border-radius:5px;cursor:pointer;margin:10px;}";
  html += ".info{background:#e9f4ff;padding:15px;border-radius:5px;margin:15px 0;}";
  html += "</style></head><body>";
  html += "<div class='container'>";
  html += "<h1>üñºÔ∏è PNG Image Upload</h1>";
  
  html += "<div class='info'>";
  html += "<strong>ÊîØÊåÅÊ†ºÂºè:</strong> PNGÂõæÂÉè<br>";
  html += "<strong>Âª∫ËÆÆÂ∞∫ÂØ∏:</strong> 640x480 ÊàñÊõ¥Â∞è<br>";
  html += "<strong>Ëá™Âä®Â§ÑÁêÜ:</strong> ÁÅ∞Â∫¶ËΩ¨Êç¢„ÄÅÁº©Êîæ„ÄÅ4bitÈáèÂåñ";
  html += "</div>";
  
  html += "<form method='POST' action='/upload' enctype='multipart/form-data'>";
  html += "<div class='upload-area'>";
  html += "<h3>üìÅ ÈÄâÊã©PNGÊñá‰ª∂</h3>";
  html += "<input type='file' name='image' accept='.png' required>";
  html += "<br><button type='submit' class='btn'>‚¨ÜÔ∏è ‰∏ä‰º†Âπ∂ËΩ¨Êç¢</button>";
  html += "</div></form>";
  
  html += "<button class='btn' onclick='window.location.href=\"/\"' style='background:#28a745;'>üè† ËøîÂõû‰∏ªÈ°µ</button>";
  html += "</div></body></html>";
  
  server.send(200, "text/html", html);
}

void handleUploadBinPage() {
  String html = "<!DOCTYPE html><html><head><meta charset='UTF-8'>";
  html += "<title>Upload BIN</title>";
  html += "<style>body{font-family:Arial;margin:40px;background:#f0f0f0;}";
  html += ".container{max-width:600px;margin:0 auto;background:white;padding:30px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1);}";
  html += "h1{color:#333;text-align:center;}";
  html += ".btn{background:#007bff;color:white;padding:10px 20px;border:none;border-radius:5px;cursor:pointer;margin:10px;}";
  html += "input{padding:8px;margin:5px;width:100px;}";
  html += "</style></head><body>";
  html += "<div class='container'>";
  html += "<h1>üì¶ Upload Raw BIN (0..15 per pixel)</h1>";
  html += "<div class='info'>Ëã•‰∏çÂ°´ÂÜôÂÆΩÈ´òÔºåÊúçÂä°Âô®Â∞ÜËá™Âä®Ê†πÊçÆÊñá‰ª∂Â§ßÂ∞èËØÜÂà´Ôºö";
  html += "307200=640x480, 76800=320x240, 19200=160x120, 58752=288x204</div>";
  html += "<form method='POST' action='/upload-bin' enctype='multipart/form-data'>";
  html += "ÂÆΩ: <input type='number' name='w' placeholder='ÂèØÈÄâ'> È´ò: <input type='number' name='h' placeholder='ÂèØÈÄâ'><br>";
  html += "<input type='file' name='file' accept='.bin' required>";
  html += "<br><button type='submit' class='btn'>‚¨ÜÔ∏è ‰∏ä‰º†BIN</button>";
  html += "</form>";
  html += "<button class='btn' onclick='window.location.href=\"/\"' style='background:#28a745;'>üè† ËøîÂõû‰∏ªÈ°µ</button>";
  html += "</div></body></html>";
  server.send(200, "text/html", html);
}

void handleUploadBin() {
  HTTPUpload& upload = server.upload();
  static File fsOut;
  static size_t rec = 0;
  static int w = 0, h = 0;

  // (FS streaming mode; no RAM growth allocator needed)

  if (upload.status == UPLOAD_FILE_START) {
    // ÂèØÈÄâË°®ÂçïÂ≠óÊÆµ
    w = server.hasArg("w") ? server.arg("w").toInt() : 0;
    h = server.hasArg("h") ? server.arg("h").toInt() : 0;
    if (uploadedImageData) { free(uploadedImageData); uploadedImageData = nullptr; }
    hasUploadedImage = false;
    hasUploadedBinFS = false;
    fsBinW = fsBinH = 0;
    rec = 0;
    SPIFFS.begin(true);
    if (SPIFFS.exists(fsBinPath)) SPIFFS.remove(fsBinPath);
    fsOut = SPIFFS.open(fsBinPath, FILE_WRITE);
    if (!fsOut) {
      server.send(500, "text/plain", "FS open failed");
      return;
    }
    Serial.printf("BIN start w=%d h=%d (optional)\n", w, h);
  } else if (upload.status == UPLOAD_FILE_WRITE) {
    if (fsOut) {
      fsOut.write(upload.buf, upload.currentSize);
      rec += upload.currentSize;
    }
  } else if (upload.status == UPLOAD_FILE_END) {
    Serial.printf("BIN end rec=%u\n", (unsigned)rec);
    // Ëã•Êú™Êèê‰æõw/hÔºåÂ∞ùËØïÊåâÂ∏∏Áî®Â∞∫ÂØ∏Êé®Êñ≠
    if (w <= 0 || h <= 0) {
      if      (rec == 640u * 480u) { w = 640; h = 480; }
      else if (rec == 320u * 240u) { w = 320; h = 240; }
      else if (rec == 160u * 120u) { w = 160; h = 120; }
      else if (rec == 288u * 204u) { w = 288; h = 204; }
    }
    if (fsOut) fsOut.close();
    if (w <= 0 || h <= 0 || rec != (size_t)w * (size_t)h) {
      if (SPIFFS.exists(fsBinPath)) SPIFFS.remove(fsBinPath);
      server.send(400, "text/plain", "Unable to infer w/h; please provide width & height");
      return;
    }
    // ÈááÁî®FSÂ≠òÂÇ®ÁöÑBIN‰Ωú‰∏∫Ê∫êÔºåÈÅøÂÖçÂ†ÜÂÜÖÂ≠òÂç†Áî®
    fsBinW = (u16)w;
    fsBinH = (u16)h;
    hasUploadedBinFS = true;
    server.send(200, "text/plain", "BIN uploaded to FS and ready");
  } else if (upload.status == UPLOAD_FILE_ABORTED) {
    if (fsOut) fsOut.close();
    if (SPIFFS.exists(fsBinPath)) SPIFFS.remove(fsBinPath);
    hasUploadedImage = false;
  }
}
void handleUpload() {
  HTTPUpload& upload = server.upload();
  static uint8_t* tempBuffer = nullptr;
  static size_t tempBufferSize = 0;
  static size_t tempReceived = 0;
  
  if (upload.status == UPLOAD_FILE_START) {
    Serial.printf("Upload Start: %s\n", upload.filename.c_str());
    
    // Ê∏ÖÁêÜ‰πãÂâçÁöÑÊï∞ÊçÆ
    if (uploadedImageData) {
      free(uploadedImageData);
      uploadedImageData = nullptr;
    }
    if (uploadedPngData) {
      free(uploadedPngData);
      uploadedPngData = nullptr;
    }
    if (tempBuffer) {
      free(tempBuffer);
      tempBuffer = nullptr;
    }
    
    hasUploadedImage = false;
    uploadedPngSize = 0;
    tempReceived = 0;
    
    // ÂàÜÈÖç‰∏¥Êó∂ÁºìÂÜ≤Âå∫Â≠òÂÇ®PNGÊï∞ÊçÆ (ÊúÄÂ§ß50KB)
    tempBufferSize = 50 * 1024;
    tempBuffer = (uint8_t*)malloc(tempBufferSize);
    if (!tempBuffer) {
      tempBufferSize = 20 * 1024;
      tempBuffer = (uint8_t*)malloc(tempBufferSize);
    }
    
    Serial.printf("Free heap: %u bytes, temp buffer: %u bytes\n", 
                  ESP.getFreeHeap(), tempBufferSize);
    
  } else if (upload.status == UPLOAD_FILE_WRITE) {
    // Â≠òÂÇ®PNGÊï∞ÊçÆÂùó
    if (upload.currentSize > 0 && tempBuffer) {
      if (tempReceived + upload.currentSize <= tempBufferSize) {
        memcpy(tempBuffer + tempReceived, upload.buf, upload.currentSize);
        tempReceived += upload.currentSize;
        Serial.printf("Upload Write: %u bytes (total: %u)\n", 
                      upload.currentSize, tempReceived);
      } else {
        Serial.println("Temp buffer overflow!");
      }
    }
    
  } else if (upload.status == UPLOAD_FILE_END) {
    Serial.printf("Upload End: %u bytes received\n", tempReceived);
    
    if (tempReceived > 0 && tempBuffer) {
      // ‰øùÂ≠òPNGÊï∞ÊçÆ
      uploadedPngData = (uint8_t*)malloc(tempReceived);
      if (uploadedPngData) {
        memcpy(uploadedPngData, tempBuffer, tempReceived);
        uploadedPngSize = tempReceived;
        
        // ÂÖàÊ∏ÖÁêÜ‰∏¥Êó∂ÁºìÂÜ≤Âå∫ÔºåÈáäÊîæÂ§ßÂùóÂÜÖÂ≠òÔºåÈÅøÂÖçÂ†ÜÁ¢éÁâáÂΩ±ÂìçÂêéÁª≠ÂõæÂÉèÂÜÖÂ≠òÂàÜÈÖç
        if (tempBuffer) {
          free(tempBuffer);
          tempBuffer = nullptr;
        }

        // Â§ÑÁêÜPNGÂπ∂ÂàõÂª∫ÂõæÂÉèÔºàÊ≠§Êó∂ÂèØÁî®ÂÜÖÂ≠òÊõ¥ÂÖÖË∂≥Ôºâ
        Serial.println("Processing uploaded PNG...");
        processPngToImage();
        
        // È™åËØÅÂõæÂÉèÁä∂ÊÄÅ
        Serial.printf("After processing - hasUploadedImage: %s, data: %p\n",
                      hasUploadedImage ? "true" : "false", uploadedImageData);
        
        String response = "<!DOCTYPE html><html><head><meta charset='UTF-8'>";
        response += "<title>Upload Success</title>";
        response += "<style>body{font-family:Arial;margin:40px;text-align:center;}";
        response += ".success{color:#28a745;font-size:24px;margin:20px;}";
        response += ".btn{background:#007bff;color:white;padding:10px 20px;border:none;border-radius:5px;text-decoration:none;margin:10px;}";
        response += "</style></head><body>";
        response += "<div class='success'>‚úÖ ÂõæÂÉè‰∏ä‰º†ÊàêÂäü!</div>";
        response += "<p>Êñá‰ª∂Â§ßÂ∞è: " + String(tempReceived) + " bytes</p>";
        response += "<p>ÂõæÂÉèÂ∑≤Â§ÑÁêÜ‰∏∫ÈÄÇÂêàARÁúºÈïúÁöÑÊ†ºÂºè</p>";
        response += "<a href='/display-image' class='btn'>üñ•Ô∏è Á´ãÂç≥ÊòæÁ§∫</a>";
        response += "<a href='/' class='btn' style='background:#28a745;'>üè† ËøîÂõû‰∏ªÈ°µ</a>";
        response += "</body></html>";
        
        server.send(200, "text/html", response);
      } else {
        Serial.println("Failed to save PNG data");
        if (tempBuffer) free(tempBuffer);
        server.send(500, "text/plain", "Failed to save uploaded data");
      }
    } else {
      if (tempBuffer) free(tempBuffer);
      server.send(400, "text/plain", "Upload failed - no data received");
    }
  } else if (upload.status == UPLOAD_FILE_ABORTED) {
    Serial.println("Upload aborted");
    if (tempBuffer) {
      free(tempBuffer);
      tempBuffer = nullptr;
    }
    hasUploadedImage = false;
  }
}

// ÂàõÂª∫ÊµãËØï‰∏ä‰º†ÂõæÂÉèÔºàÂç†‰ΩçÁ¨¶ÂáΩÊï∞Ôºâ
void createTestUploadedImage() {
  Serial.printf("Creating test image... Free heap: %u bytes\n", ESP.getFreeHeap());
  
  // ‰ΩøÁî®Êõ¥Â∞èÁöÑÂõæÂÉèÂ∞∫ÂØ∏‰ª•ÈÄÇÂ∫îÂÜÖÂ≠òÈôêÂà∂
  uploadedImageWidth = 320;
  uploadedImageHeight = 240;
  
  size_t imageSize = uploadedImageWidth * uploadedImageHeight;
  Serial.printf("Attempting to allocate %u bytes for image\n", imageSize);
  
  uploadedImageData = (u8*)malloc(imageSize);
  
  if (uploadedImageData) {
    Serial.println("Image memory allocated successfully");
    
    // ÂàõÂª∫‰∏Ä‰∏™ÁÆÄÂçïÁöÑÊµãËØïÂõæÊ°à
    for (u16 y = 0; y < uploadedImageHeight; y++) {
      for (u16 x = 0; x < uploadedImageWidth; x++) {
        u8 value;
        // ÂàõÂª∫‰∏Ä‰∏™ÂúÜÂΩ¢ÂõæÊ°à
        int centerX = uploadedImageWidth / 2;
        int centerY = uploadedImageHeight / 2;
        int dx = x - centerX;
        int dy = y - centerY;
        int distance = dx * dx + dy * dy;
        int radius = 60;
        
        if (distance < radius * radius) {
          value = 15; // ÂúÜÂΩ¢ÂÜÖÈÉ® - ‰∫Æ
        } else if ((x / 20 + y / 20) % 2 == 0) {
          value = 8;  // Â§ñÈÉ®Ê£ãÁõòÊ†º - ‰∏≠Á≠â
        } else {
          value = 2;  // Â§ñÈÉ®Ê£ãÁõòÊ†º - Êöó
        }
        uploadedImageData[y * uploadedImageWidth + x] = value;
      }
    }
    hasUploadedImage = true;
    Serial.printf("ÊµãËØïÂõæÂÉèÂ∑≤ÂàõÂª∫ (%ux%u) - hasUploadedImage: %s, data: %p\n", 
                  uploadedImageWidth, uploadedImageHeight,
                  hasUploadedImage ? "true" : "false", uploadedImageData);
  } else {
    Serial.println("Failed to allocate image memory! Trying even smaller size...");
    
    // Â∞ùËØïÊõ¥Â∞èÁöÑÂ∞∫ÂØ∏
    uploadedImageWidth = 160;
    uploadedImageHeight = 120;
    imageSize = uploadedImageWidth * uploadedImageHeight;
    
    Serial.printf("Trying smaller allocation: %u bytes\n", imageSize);
    uploadedImageData = (u8*)malloc(imageSize);
    
    if (uploadedImageData) {
      // ÂàõÂª∫ÁÆÄÂçïÁöÑÊµãËØïÂõæÊ°à
      for (u16 y = 0; y < uploadedImageHeight; y++) {
        for (u16 x = 0; x < uploadedImageWidth; x++) {
          u8 value = ((x / 10 + y / 10) % 2 == 0) ? 15 : 3;
          uploadedImageData[y * uploadedImageWidth + x] = value;
        }
      }
      hasUploadedImage = true;
      Serial.printf("Â∞èÂ∞∫ÂØ∏ÊµãËØïÂõæÂÉèÂ∑≤ÂàõÂª∫ (%ux%u)\n", uploadedImageWidth, uploadedImageHeight);
    } else {
      Serial.println("Failed to allocate even smaller image memory!");
      hasUploadedImage = false;
    }
  }
}

// ÁÆÄÂåñÁöÑPNGÂ§ÑÁêÜÂáΩÊï∞
void processPngToImage() {
  Serial.printf("Starting PNG processing... Free heap: %u\n", ESP.getFreeHeap());
  
  if (!uploadedPngData || uploadedPngSize == 0) {
    Serial.println("No PNG data - creating fallback image");
    createTestUploadedImage();
    return;
  }
  
  Serial.printf("Processing PNG: %u bytes\n", uploadedPngSize);
  
  // Áõ¥Êé•‰ΩøÁî®Â∞èÂ∞∫ÂØ∏ÔºåÁ°Æ‰øùÂÜÖÂ≠òË∂≥Â§ü
  uploadedImageWidth = 160;
  uploadedImageHeight = 120;
  
  size_t imageSize = uploadedImageWidth * uploadedImageHeight;
  Serial.printf("Allocating %u bytes for image\n", imageSize);
  
  uploadedImageData = (u8*)malloc(imageSize);
  
  if (!uploadedImageData) {
    Serial.println("Allocation failed - trying test image");
    createTestUploadedImage();
    return;
  }
  
  Serial.println("Creating pattern from PNG data...");
  
  // ‰ΩøÁî®PNGÊï∞ÊçÆÁöÑÁÆÄÂçïÊï£ÂàóÂàõÂª∫ÂõæÊ°à
  for (u16 y = 0; y < uploadedImageHeight; y++) {
    for (u16 x = 0; x < uploadedImageWidth; x++) {
      // ‰ΩøÁî®PNGÊï∞ÊçÆÂàõÂª∫Áã¨ÁâπÂõæÊ°à
      size_t dataIndex = ((y * uploadedImageWidth + x) * 7) % uploadedPngSize;
      u8 pngByte = uploadedPngData[dataIndex];
      
      // ÁÆÄÂçïÊò†Â∞ÑÂà∞4bitÁÅ∞Â∫¶
      u8 value = pngByte >> 4; // ÂèñÈ´ò4‰Ωç
      if (value == 0) value = 1; // ÈÅøÂÖçÂÖ®Èªë
      
      uploadedImageData[y * uploadedImageWidth + x] = value;
    }
  }
  
  hasUploadedImage = true;
  Serial.printf("‚úÖ PNG processed successfully (%ux%u) - hasImage: %s, data: %p\n", 
                uploadedImageWidth, uploadedImageHeight,
                hasUploadedImage ? "true" : "false", uploadedImageData);
}

void handleDisplayImage() {
  Serial.printf("Display image request - hasUploadedImage: %s, uploadedImageData: %p\n", 
                hasUploadedImage ? "true" : "false", uploadedImageData);
  
  if (!hasUploadedImage || !uploadedImageData) {
    String errorMsg = "No image uploaded - hasImage: ";
    errorMsg += hasUploadedImage ? "true" : "false";
    errorMsg += ", data: ";
    errorMsg += uploadedImageData ? "valid" : "null";
    
    server.send(400, "text/plain", errorMsg);
    Serial.println(errorMsg);
    return;
  }
  
  Serial.println("ÂºÄÂßãÊòæÁ§∫‰∏ä‰º†ÁöÑÂõæÂÉè...");
  displayUploadedImage();
  
  server.send(200, "text/plain", "Image displayed successfully!");
}

void displayUploadedImage() {
  if (!hasUploadedImage && !hasUploadedBinFS) {
    Serial.println("ÈîôËØØ: Ê≤°Êúâ‰∏ä‰º†ÁöÑÂõæÂÉèÊï∞ÊçÆ");
    return;
  }
  
  const u16 panelWidth = 640;
  const u16 panelHeight = 480;
  const u16 chunkRows = 60;
  const u16 bytesPerRow = panelWidth / 2;
  
  u16 rowStart = 0;
  while (rowStart < panelHeight) {
    u16 rowsNow = (panelHeight - rowStart) > chunkRows ? chunkRows : (panelHeight - rowStart);
    
    // Ê∏ÖÁ©∫ÁºìÂÜ≤Âå∫
    memset(image, 0, (size_t)bytesPerRow * (size_t)rowsNow);
    
    if (hasUploadedBinFS) {
      // ‰ªéFSÊåâË°åËØªÂèñBINÂπ∂ÊâìÂåÖ
      File f = SPIFFS.open(fsBinPath, FILE_READ);
      if (!f) { Serial.println("FS open failed"); return; }
      // ËØªÂèñÂØπÂ∫îÊ∫êË°åËåÉÂõ¥Âà∞‰∏Ä‰∏™Â∞èÁºìÂÜ≤
      const u32 srcStride = (u32)fsBinW; // ÊØèË°åÂ≠óËäÇ
      const u32 startOff = (u32)rowStart * srcStride * (u32)fsBinH / (u32)panelHeight; // ÂÖàÁ≤óÁï•ÔºåÂÆûÈôÖpackÂáΩÊï∞‰ºöÈáçÊñ∞ÈááÊ†∑
      // ÁÆÄÂåñÔºö‰∏ÄÊ¨°ÊÄßËØª rowsNow ÂØπÂ∫îÁöÑËøë‰ººÂ≠óËäÇÔºàË∂≥Â§üÔºâ
      const u32 approxRows = rowsNow * fsBinH / panelHeight + 2;
      const u32 readBytes = approxRows * srcStride;
      static u8 lineBuf[640*64]; // Á∫¶40KB‰∏äÈôê
      f.seek(startOff, SeekSet);
      size_t got = f.read(lineBuf, readBytes > sizeof(lineBuf) ? sizeof(lineBuf) : readBytes);
      f.close();
      // ‰ΩøÁî®packÂáΩÊï∞ÂØπ lineBuf ËøõË°åÁº©ÊîæÊâìÂåÖÔºàÊ∫êÂÆΩ=fsBinWÔºåÈ´òÂ∫¶Ëøë‰ººÔºâ
      packPngScaledRowsToPanel(image, panelWidth, panelHeight,
                               lineBuf, fsBinW, fsBinH,
                               rowStart, rowsNow, invertEnabled);
    } else {
      // ÊâìÂåÖÂÜÖÂ≠ò‰∏≠ÁöÑÂõæÂÉè
      packPngScaledRowsToPanel(image, panelWidth, panelHeight, 
                               uploadedImageData, uploadedImageWidth, uploadedImageHeight, 
                               rowStart, rowsNow, invertEnabled);
    }
    
    u32 lenBytes = (u32)bytesPerRow * (u32)rowsNow;
    display_image(image, lenBytes, 0, (u16)rowStart);
    rowStart += rowsNow;
  }
  
  Serial.println("‰∏ä‰º†ÂõæÂÉèÊòæÁ§∫ÂÆåÊàê");
}

void setupWebServer() {
  server.on("/", handleRoot);
  server.on("/brightness", handleBrightness);
  server.on("/flip", handleFlip);
  server.on("/display-power", handleDisplayPower);
  server.on("/status", handleStatus);
  server.on("/api/brightness", handleGetBrightness);
  server.on("/invert", handleInvert);
  server.on("/api/wifi-status", handleGetWiFiStatus);
  server.on("/upload", HTTP_GET, handleUploadPage);
  server.on("/upload", HTTP_POST, []() { server.send(200); }, handleUpload);
  server.on("/upload-bin", HTTP_GET, handleUploadBinPage);
  server.on("/upload-bin", HTTP_POST, []() { server.send(200); }, handleUploadBin);
  server.on("/display-image", handleDisplayImage);
  
  server.begin();
  Serial.println("WebÊúçÂä°Âô®ÂêØÂä®ÊàêÂäü!");
  Serial.print("ËÆøÈóÆÂú∞ÂùÄ: http://");
  Serial.println(WiFi.localIP());
}

// ÁîüÊàêÂ∏¶ÈÄèÊòéËÉåÊôØÁöÑÁªøËâ≤ÂúÜÂΩ¢Âà∞Â∏ßÁºìÂÜ≤Ôºà4bitÁÅ∞Â∫¶ÔºåÊØèÂ≠óËäÇ‰∏§‰∏™ÂÉèÁ¥†Ôºâ
void renderGreenCircle(u8 *dest, u16 widthPixels, u16 heightRows, u8 grayLevel) {
  u8 level = (grayLevel > 15) ? 15 : grayLevel;
  u16 bytesPerRow = widthPixels / 2; // ÊØèÂ≠óËäÇ‰∏§‰∏™ÂÉèÁ¥†
  float cx = (float)widthPixels * 0.5f;
  float cy = (float)heightRows * 0.5f;
  float radius = (heightRows < widthPixels ? (float)heightRows : (float)widthPixels) * 0.35f;
  float r2 = radius * radius;

  for (u16 y = 0; y < heightRows; y++) {
    for (u16 x = 0; x < widthPixels; x += 2) {
      float dx0 = (float)x - cx;
      float dy0 = (float)y - cy;
      float dx1 = (float)(x + 1) - cx;
      float dy1 = dy0;
      bool on0 = (dx0 * dx0 + dy0 * dy0) <= r2;
      bool on1 = (dx1 * dx1 + dy1 * dy1) <= r2;
      u8 hi = on0 ? level : 0;
      u8 lo = on1 ? level : 0;
      dest[y * bytesPerRow + (x >> 1)] = (hi << 4) | lo;
    }
  }
}

// Â∞ÜÊØèÂÉèÁ¥†1Â≠óËäÇ(0..15)ÁöÑPNGË°åÂùóÊâìÂåÖ‰∏∫Èù¢Êùø4bit/ÂÉèÁ¥†ÁºìÂÜ≤ÔºàÊØèÂ≠óËäÇ2ÂÉèÁ¥†ÔºåË°åÂÆΩÂõ∫ÂÆödestWidth=640Ôºâ
void packPngRowsToPanel(u8 *dest, u16 destWidth, const u8 *src, u16 srcWidth, u16 rowStart, u16 rows) {
  u16 bytesPerRow = destWidth / 2;
  for (u16 ry = 0; ry < rows; ry++) {
    u16 y = rowStart + ry;
    const u8 *srcRow = src + (u32)y * (u32)srcWidth;
    u8 *dstRow = dest + (u32)ry * (u32)bytesPerRow;
    for (u16 x = 0; x < destWidth; x += 2) {
      u8 g0 = 0, g1 = 0;
      if (x < srcWidth) {
        u8 v0 = srcRow[x] & 0x0F;
        g0 = (u8)(0x0F - v0); // invert: 0 -> 15 (bright), 15 -> 0 (black)
      }
      if ((x + 1) < srcWidth) {
        u8 v1 = srcRow[x + 1] & 0x0F;
        g1 = (u8)(0x0F - v1);
      }
      dstRow[x >> 1] = (g0 << 4) | g1;
    }
  }
}

// Â∞ÜPNGÁº©ÊîæÂà∞Â±èÂπïÂ∞∫ÂØ∏ÔºàÊúÄËøëÈÇªÔºâÔºåÂπ∂ÊåâË°åÂùóÊâìÂåÖÔºà4bit/ÂÉèÁ¥†Ôºå0..15Ôºâ„ÄÇ
void packPngScaledRowsToPanel(u8 *dest,
                              u16 destWidth,
                              u16 destHeight,
                              const u8 *src,
                              u16 srcWidth,
                              u16 srcHeight,
                              u16 rowStart,
                              u16 rows,
                              bool invert) {
  u16 bytesPerRow = destWidth / 2;
  for (u16 ry = 0; ry < rows; ry++) {
    u16 yDst = rowStart + ry;
    u32 ySrc = ((u32)yDst * (u32)srcHeight) / (u32)destHeight;
    if (ySrc >= srcHeight) ySrc = srcHeight - 1;
    const u8 *srcRow = src + (u32)ySrc * (u32)srcWidth;
    u8 *dstRow = dest + (u32)ry * (u32)bytesPerRow;
    for (u16 x = 0; x < destWidth; x += 2) {
      u32 x0Src = ((u32)x * (u32)srcWidth) / (u32)destWidth;
      if (x0Src >= srcWidth) x0Src = srcWidth - 1;
      u32 x1Src = ((u32)(x + 1) * (u32)srcWidth) / (u32)destWidth;
      if (x1Src >= srcWidth) x1Src = srcWidth - 1;
      u8 v0 = srcRow[x0Src] & 0x0F;
      u8 v1 = srcRow[x1Src] & 0x0F;
      if (invert) {
        v0 = (u8)(0x0F - v0);
        v1 = (u8)(0x0F - v1);
      }
      dstRow[x >> 1] = (v0 << 4) | v1;
    }
  }
}

// u32 ID=read_id();
void setup()
{

  // ÂàùÂßãÂåñÂºïËÑö
  //JBD_init();
  // ÈÖçÁΩÆSPIËÆæÁΩÆ
  SPI.begin(SPI_CLK, SPI_MISO, SPI_MOSI, SPI_CS);
  //SPI.begin();
  SPI.setBitOrder(MSBFIRST);           // Êï∞ÊçÆ‰ΩçÈ°∫Â∫èÔºåÊúÄÈ´òÊúâÊïà‰ΩçÂÖà‰º†Ëæì
  SPI.setDataMode(SPI_MODE0);          // Êó∂ÈíüÁõ∏‰ΩçÂíåÊûÅÊÄßÔºåÊ®°Âºè
  SPI.setClockDivider(SPI_CLOCK_DIV4); //
  pinMode(SPI_CS, OUTPUT);
  digitalWrite(SPI_CS, HIGH); // ÈªòËÆ§Á¶ÅÁî®‰ªéËÆæÂ§á
  Serial.begin(115200);
  Serial.println("AR-Ldc-Vision ÂàùÂßãÂåñ‰∏≠...");
  delay_ms(10);
  //u32 ID = read_id();
  //u8 Stus = rd_status_reg(SPI_RD_STATUS_REG2);
  //u16 lum = rd_lum_reg();
  //send_cmd(SPI_SELF_TEST_ALL_ON);
  //send_cmd(SPI_SYNC);
  //get_temperature_sensor_data(0x26);
  //u8 elc = rd_cur_reg();
  //lum = rd_lum_reg();
  //u16 ofs=rd_offset_reg();
  //delay_ms(10);
  // ÂàùÂßãÂåñÈù¢Êùø
  panel_init();
  
  // ËÆæÁΩÆÊñáÊú¨Ê∞¥Âπ≥ÁøªËΩ¨ (true = ÁøªËΩ¨, false = Ê≠£Â∏∏)
  setTextHorizontalFlip(true);
  
  // ËÆæÁΩÆ‰Ωé‰∫ÆÂ∫¶ (ÂêØÂä®ÈªòËÆ§)
  setBrightnessLow(); 
  // setBrightness(800);  

  // ËøûÊé•WiFiÂπ∂ÂêØÂä®WebÊúçÂä°Âô®
  connectToWiFi();
  if (WiFi.status() == WL_CONNECTED) {
    setupWebServer();
  }  

  // ‰ΩøÁî®È¢ÑÂ§ÑÁêÜÂêéÁöÑÊú¨Âú∞ÂõæÂÉèÔºà640x480ÔºâÂàÜÂùóÂÜôÂÖ•ÔºåÈÅøÂÖçÁº©Êîæ‰∏éÂèçÁõ∏
  const u16 panelWidth = 640;
  const u16 panelHeight = 480;
  const u16 chunkRows = 60; // 480/60=8Êï¥ÂùóÔºåÈÅøÂÖçËæπÁïå‰º™ÂΩ±
  const u16 bytesPerRow = panelWidth / 2;
  u16 rowStart = 0;
  while (rowStart < panelHeight) {
    u16 rowsNow = (panelHeight - rowStart) > chunkRows ? chunkRows : (panelHeight - rowStart);
    memset(image, 0, (size_t)bytesPerRow * (size_t)rowsNow);
    packPngScaledRowsToPanel(image, panelWidth, panelHeight,
                             group1_data, group1_width, group1_height,
                             rowStart, rowsNow, invertEnabled);
    u32 lenBytes = (u32)bytesPerRow * (u32)rowsNow;
    display_image(image, lenBytes, 0, (u16)rowStart);
    rowStart += rowsNow;
  }
}

void loop()
{
  // Â§ÑÁêÜWebÊúçÂä°Âô®ËØ∑Ê±Ç
  server.handleClient();

  // display_image(image, image_len);

  /*
  ============================
  ‰∫ÆÂ∫¶ÊéßÂà∂Á§∫‰æã - ÂèØ‰ª•Âú®ËøôÈáåÂä®ÊÄÅË∞ÉÊï¥‰∫ÆÂ∫¶
  ============================
  */
  // Á§∫‰æã: Âä®ÊÄÅ‰∫ÆÂ∫¶Ë∞ÉÊï¥ (ÂèñÊ∂àÊ≥®Èáä‰ª•ÂêØÁî®)
  // static unsigned long lastBrightnessChange = 0;
  // if (millis() - lastBrightnessChange > 5000) { // ÊØè5ÁßíÊîπÂèò‰∏ÄÊ¨°
  //   static bool lowBrightness = true;
  //   if (lowBrightness) {
  //     setBrightnessMedium();
  //   } else {
  //     setBrightnessLow();
  //   }
  //   lowBrightness = !lowBrightness;
  //   lastBrightnessChange = millis();
  // }

  // ÁõëÊéßÂΩìÂâçËÆæÁΩÆ (ÂèØÈÄâ - ÂèñÊ∂àÊ≥®Èáä‰ª•Âú®‰∏≤Âè£Êü•Áúã)
  // u8 elc = rd_cur_reg();
  // u16 lum = rd_lum_reg();
  // u16 ofs = rd_offset_reg();
  // delay(100);
  // MySerial_esp32.println("cosSerial test!!!");
  // MySerial_esp32.print("ID:");
  // MySerial_esp32.println(ID);
  // delay(100);
  // MySerial_esp32.print("ÁîµÊµÅ:");
  // MySerial_esp32.println(elc);
  // delay(100);
  // MySerial_esp32.print("‰∫ÆÂ∫¶:");
  // MySerial_esp32.println(lum);
  // delay(100);
  // MySerial_esp32.print("ÂÅèÁßª:");
  // MySerial_esp32.println(ofs);
  // delay(500);
  /*
  ============================
  */
  // ÂèëÈÄÅÊï∞ÊçÆ
  // SPI.transfer(0x01); // ÂèëÈÄÅ‰∏Ä‰∏™Â≠óËäÇÁöÑÊï∞ÊçÆ
  /*
  ==========================================
  ÈÄªËæëÂàÜÊûê‰ª™ÊµãËØï
  digitalWrite(PANELD2,HIGH);
  delay(500);
  digitalWrite(PANELD2,LOW);
  delay(500);
  ==========================================
  */
  // delay(100); // Á≠âÂæÖ0.1ÁßíÈíü
}

